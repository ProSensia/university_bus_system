# ===============================
# Basic Security
# ===============================
Options -Indexes
ServerSignature Off

# ===============================
# Force HTTPS
# ===============================
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ===============================
# Block sensitive file types
# ===============================
<FilesMatch "\.(env|log|sql|ini|conf|json)$">
    Require all denied
</FilesMatch>

<Files "config.local.php">
    Require all denied
</Files>

# ===============================
# Protect logs directory (filesystem only)
# ===============================
<IfModule mod_rewrite.c>
    RewriteRule ^logs/ - [F,L]
</IfModule>

# ===============================
# Uploads: no directory listing (but accessible)
# ===============================
<Directory "uploads">
    Options -Indexes
</Directory>

# ===============================
# Security Headers
# ===============================
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header unset X-Powered-By
</IfModule>

# ===============================
# Compression
# ===============================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css application/javascript
</IfModule>

# ===============================
# Cache Control
# ===============================
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 2 days"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png  "access plus 1 month"
    ExpiresByType text/css   "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ===============================
# Protect .htaccess itself
# ===============================
<Files ".htaccess">
    Require all denied
</Files>
